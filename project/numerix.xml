<xml>
   <!-- <set name="static_link" value="1" /> -->
   <include name="${HXCPP}/toolchain/haxe-target.xml" />
   <set name="NX_GPU" value="1" unless="rpi" />
   <set name="NX_CUDA" value="1" unless="rpi" />

   <files id="numerix" >
     <compilerflag value="-Iinclude" />
     <compilerflag value="-DNX_GPU" if="NX_GPU" />
     <compilerflag value="-DNX_CUDA" if="NX_CUDA" />
     <compilerflag value="-DNUMERIX_SIMD" />
     <compilerflag value="-mfpu=neon" if="HXCPP_ARMV7||HXCPP_ARM64" />
     <section if="rpi" >
        <compilerflag value="-mfpu=neon-vfpv4" />
        <compilerflag value="-mfloat-abi=hard" />
        <compilerflag value="-mcpu=cortex-a7" />
        <compilerflag value="-fPIC" />
     </section>


     <depend name="include/Tensor.h" />
     <depend name="include/Ops.h" />
     <depend name="include/NxThread.h" />
     <depend name="include/Layer.h" />

     <file name="src/Api.cpp" />
     <file name="src/Tensor.cpp" />
     <file name="src/TensorData.cpp" />
     <file name="src/Ops.cpp" />
     <file name="src/NxThread.cpp" />
     <file name="src/DynamicLoad.cpp" />
     <file name="src/layers/Conv2D.cpp" />
     <file name="src/layers/MaxPool.cpp" />
     <file name="src/layers/Layer.cpp" />
     <file name="src/layers/Concat.cpp" />
     <file name="src/layers/Reorg.cpp" />
     <file name="src/layers/Yolo.cpp" />

     <file name="src/Cuda.cpp" if="NX_CUDA"  />

     <section if="linux||rpi" >
        <compilerflag value="-Isrc/movidius" />
        <compilerflag value="-DNX_MOVIDIUS" />
        <file name="src/movidius/dynamic_mvnc.cpp" />
        <file name="src/layers/Movidius.cpp" />
     </section>

   </files>

   <files id="nnpack" dir="src/nnpack" >
      <compilerflag value="-DNNP_INFERENCE_ONLY" />
      <compilerflag value="-Iinclude" />
      <compilerflag value="-I${HXCPP}/include" />
      <compilerflag value="-Iinclude/fakepthread" if="windows" />
      <compilerflag value="-Isrc/nnpack" />
      <compilerflag value="-mfpu=neon" if="HXCPP_ARMV7||HXCPP_ARM64" />
      <section if="rpi" >
         <compilerflag value="-mfpu=neon-vfpv4" />
         <compilerflag value="-mfloat-abi=hard" />
         <compilerflag value="-mcpu=cortex-a7" />
         <compilerflag value="-fPIC" />
      </section>

      <file name="softmax-output.c" />
      <file name="relu-output.c" />
      <file name="pooling-output.c" />
      <file name="init.c" />
      <file name="fully-connected-output.c" />
      <file name="fully-connected-inference.c" />
      <file name="convolution-output.c" />
      <file name="convolution-inference.c" />

   </files>

   <target id="default" tool="linker" toolid="dll" output="numerix" >
      <files id="numerix" />
      <files id="nnpack" if="nnpack" />
      <outdir name="../ndll/${BINDIR}" />
      <ext value=".ndll" />

      <lib name="-lpthread" if="linux" unless="static_link" />
   </target>

</xml>
