<xml>
   <!-- <set name="static_link" value="1" /> -->
   <include name="${HXCPP}/toolchain/haxe-target.xml" />
   <set name="NX_GPU" value="1" unless="rpi" />
   <set name="NX_CUDA" value="1" unless="rpi" />

   <section if="NX_OPENCL">
      <set name="OPENCL_SDK" value="${INTELOCLSDKROOT}" if="INTELOCLSDKROOT" unless="OPENCL_SDK" />
      <set name="OCL_ARCH" value="x86" unless="HXCPP_M64" />
      <set name="OCL_ARCH" value="x64" if="HXCPP_M64" />
   </section>

   <files id="numerix" >
     <compilerflag value="-Iinclude" />
     <compilerflag value="-I${OPENCL_SDK}/include" if="NX_OPENCL" />
     <compilerflag value="-DNX_GPU" if="NX_GPU" />
     <compilerflag value="-DNX_CUDA" if="NX_CUDA" />
     <compilerflag value="-DNX_OPENCL" if="NX_OPENCL" />
     <compilerflag value="-DNUMERIX_SIMD" />
     <compilerflag value="-mfpu=neon" if="HXCPP_ARMV7||HXCPP_ARM64" />
     <section if="rpi" >
        <compilerflag value="-mfpu=neon-vfpv4" />
        <compilerflag value="-mfloat-abi=hard" />
        <compilerflag value="-mcpu=cortex-a7" />
        <compilerflag value="-fPIC" />
     </section>


     <depend name="include/Tensor.h" />
     <depend name="include/Ops.h" />
     <depend name="include/NxThread.h" />
     <depend name="include/Layer.h" />

     <file name="src/Api.cpp" />
     <file name="src/Tensor.cpp" />
     <file name="src/TensorData.cpp" />
     <file name="src/Ops.cpp" />
     <file name="src/NxThread.cpp" />
     <file name="src/DynamicLoad.cpp" />
     <file name="src/layers/Conv2D.cpp" />
     <file name="src/layers/MaxPool.cpp" />
     <file name="src/layers/Layer.cpp" />
     <file name="src/layers/Concat.cpp" />
     <file name="src/layers/Reorg.cpp" />
     <file name="src/layers/Yolo.cpp" />

     <file name="src/Cuda.cpp" if="NX_CUDA"  />

     <file name="src/OpenCL.cpp" if="NX_OPENCL"  />

     <section if="linux||rpi" >
        <compilerflag value="-Isrc/movidius" />
        <compilerflag value="-DNX_MOVIDIUS" />
        <file name="src/movidius/dynamic_mvnc.cpp" />
        <file name="src/layers/Movidius.cpp" />
     </section>

   </files>


   <target id="default" tool="linker" toolid="dll" output="numerix" >
      <files id="numerix" />
      <outdir name="../ndll/${BINDIR}" />
      <ext value=".ndll" />

      <libpath name="${OPENCL_SDK}/lib/${OCL_ARCH}" if="NX_OPENCL" />
      <lib name="OpenCL.lib" if="NX_OPENCL" />
      <lib name="-lpthread" if="linux" unless="static_link" />
   </target>

</xml>
